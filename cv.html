<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mon CV - Djould√© Barry</title>
    <link rel="stylesheet" href="cv.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
</head>
<body>

    <!-- Navigation -->
    <nav class="navbar">
        <a href="index.html" class="back-button">‚Üê Retour</a>
        <button class="toggle-dark-mode" onclick="toggleDarkMode()">üåô Mode Sombre</button>
        <h1>Mon CV</h1>
    </nav>

    <!-- Conteneur principal -->
    <section class="cv-container">
        <div class="cv-box">
            <h2>üìÑ CV en Fran√ßais</h2>
            <p class="cv-description"><i class="fas fa-file-alt"></i> Un r√©sum√© d√©taillant mon parcours et mes comp√©tences en Data Engineering.</p>
            <div class="cv-loader">‚è≥ Chargement du CV...</div>
            <iframe src="files/CV_Barry_FR.pdf" class="cv-frame"></iframe>
            <p id="cv-fr" class="cv-update-date"></p>
            <p id="recent-update-fr" class="recent-update"></p> <!-- ‚úÖ Message "Mise √† jour r√©cente" -->
            <button class="btn-copy" onclick="copyCvLink('files/CV_Barry_FR.pdf')">üìã Copier le lien</button>
            <a href="files/CV_Barry_FR.pdf" download class="btn-download">T√©l√©charger üì•</a>
        </div>

        <div class="cv-box">
            <h2>üìÑ CV en Anglais</h2>
            <p class="cv-description"><i class="fas fa-file-alt"></i> English resume showcasing my experience in Big Data & Cloud Solutions.</p>
            <div class="cv-loader">‚è≥ Loading resume...</div>
            <iframe src="files/CV_Barry_EN.pdf" class="cv-frame"></iframe>
            <p id="cv-en" class="cv-update-date"></p>
            <p id="recent-update-en" class="recent-update"></p> <!-- ‚úÖ Message "Mise √† jour r√©cente" -->
            <button class="btn-copy" onclick="copyCvLink('files/CV_Barry_EN.pdf')">üìã Copy Link</button>
            <a href="files/CV_Barry_EN.pdf" download class="btn-download">Download üì•</a>
        </div>
    </section>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            // Liste des fichiers CV
            const cvs = [
                { id: "cv-fr", file: "files/CV_Barry_FR.pdf", recentId: "recent-update-fr" },
                { id: "cv-en", file: "files/CV_Barry_EN.pdf", recentId: "recent-update-en" }
            ];
    
            cvs.forEach(cv => {
                fetch(cv.file, { method: 'HEAD' })
                    .then(response => {
                        let lastModified = response.headers.get("Last-Modified");
                        if (lastModified) {
                            let date = new Date(lastModified);
                            let formattedDate = date.toLocaleDateString("fr-FR", {
                                year: "numeric",
                                month: "long",
                                day: "numeric"
                            });
    
                            document.getElementById(cv.id).textContent = `Derni√®re mise √† jour : ${formattedDate}`;
                            
                            // ‚úÖ V√©rifie si la mise √† jour est r√©cente (moins de 3 mois)
                            let today = new Date();
                            let diffTime = Math.abs(today - date);
                            let diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
                            
                            if (diffDays <= 90) {
                                document.getElementById(cv.recentId).textContent = "üöÄ Mise √† jour r√©cente";
                            }
                        }
                    })
                    .catch(error => console.log("Erreur lors de la r√©cup√©ration de la date :", error));
            });

            document.querySelectorAll(".cv-frame").forEach((iframe) => {
                let loader = iframe.previousElementSibling; // Cible l'√©l√©ment de chargement
                iframe.style.display = "none"; // Cache le CV au d√©part

                iframe.onload = function () {
                    loader.style.display = "none"; // Cache le loader
                    iframe.style.display = "block"; // Affiche le CV une fois charg√©
                };
            });
        });

        // ‚úÖ Animation de l‚Äôapparition progressive des CV
        function revealOnScroll() {
            let cvContainer = document.querySelector(".cv-container");
            let sectionPosition = cvContainer.getBoundingClientRect().top;
            let screenPosition = window.innerHeight / 1.3;

            if (sectionPosition < screenPosition) {
                cvContainer.classList.add("show");
            }
        }

        window.addEventListener("scroll", revealOnScroll);

        function copyCvLink(fileUrl) {
            let fullUrl = window.location.origin + "/" + fileUrl;
            navigator.clipboard.writeText(fullUrl).then(() => {
                alert("üìã Lien copi√© : " + fullUrl);
            }).catch(err => {
                console.error("Erreur lors de la copie du lien", err);
            });
        }
        function toggleDarkMode() {
            document.body.classList.toggle("dark-mode");
            let mode = document.body.classList.contains("dark-mode") ? "dark" : "light";
            localStorage.setItem("theme", mode);
        }

        // ‚úÖ Conserve le mode choisi par l'utilisateur
        document.addEventListener("DOMContentLoaded", function () {
            if (localStorage.getItem("theme") === "dark") {
                document.body.classList.add("dark-mode");
            }
        });
    </script>    

</body>
</html>